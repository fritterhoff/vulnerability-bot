FROM golang:alpine AS builder
RUN apk add -U --no-cache ca-certificates

WORKDIR /src
COPY go.* /src/
RUN go mod download

ADD .  .
RUN CGO_ENABLED=0 go build

FROM busybox

COPY --from=builder /src/vulnerability-bot /
COPY --from=builder /etc/ssl/certs/ca-certificates.crt /etc/ssl/certs/

ENTRYPOINT ["/vulnerability-bot"]